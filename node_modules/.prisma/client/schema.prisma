generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Player {
  id                  Int      @id @default(autoincrement())
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  /// Pseudo affiché dans l'appli
  nickname            String   @unique
  /// Email pour l'authentification (on pourra aussi permettre un login par pseudo)
  email               String   @unique
  /// Hash du mot de passe (jamais stocker le mot de passe en clair)
  passwordHash        String
  /// Numéro de licence FFBaD (obligatoire, unique)
  licenseNumber       String   @unique
  /// Classement de simple (nombre de points)
  singleRankingPoints Int?

  /// Matchs où ce joueur est player1
  matchesAsPlayer1 Match[] @relation("Player1Matches")
  /// Matchs où ce joueur est player2
  matchesAsPlayer2 Match[] @relation("Player2Matches")
}

model Match {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Joueur 1 (celui qui saisit le match)
  player1Id Int
  player1   Player @relation("Player1Matches", fields: [player1Id], references: [id], onDelete: Cascade)

  /// Joueur 2 (l'adversaire)
  player2Id Int
  player2   Player @relation("Player2Matches", fields: [player2Id], references: [id], onDelete: Cascade)

  /// Nombre de sets gagnés par le joueur 1 (0, 1 ou 2) - calculé automatiquement
  player1Sets Int @default(0)

  /// Nombre de sets gagnés par le joueur 2 (0, 1 ou 2) - calculé automatiquement
  player2Sets Int @default(0)

  /// Score du joueur 1 dans le set 1
  set1Player1Score Int?

  /// Score du joueur 2 dans le set 1
  set1Player2Score Int?

  /// Score du joueur 1 dans le set 2
  set2Player1Score Int?

  /// Score du joueur 2 dans le set 2
  set2Player2Score Int?

  /// Score du joueur 1 dans le set 3 (optionnel, seulement si match en 3 sets)
  set3Player1Score Int?

  /// Score du joueur 2 dans le set 3 (optionnel, seulement si match en 3 sets)
  set3Player2Score Int?

  /// Date à laquelle le match a eu lieu
  matchDate DateTime

  /// Mois du match (1-12) pour le classement mensuel
  month Int

  /// Année du match pour le classement mensuel
  year Int

  /// Index pour faciliter les requêtes de classement mensuel
  @@index([month, year])
  @@index([player1Id])
  @@index([player2Id])
}
